@base <http://graphity.org/> .

@prefix : <ontology/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix sioc: <http://rdfs.org/sioc/ns#> .
@prefix sp: <http://spinrdf.org/sp#> .
@prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
@prefix vann: <http://purl.org/vocab/vann/> .
@prefix g: <http://graphity.org/ontology/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix gfb-app: <http://graph.facebook.com/schema/application#> .

: a owl:Ontology ;
    dc:title "Graphity ontology" ;
    rdfs:label "Graphity ontology" ;
    dct:modified "2012-02-09T20:54:00+01:00"^^xsd:dateTime ;
    vann:preferredNamespaceUri "http://graphity.org/ontology/" ;
    vann:preferredNamespacePrefix "g";
    rdfs:seeAlso <http://graphity.org> ;
    dct:license <http://www.opendatacommons.org/licenses/pddl/1.0/> ;
    dc:creator <http://semantic-web.dk#martynas> .
<http://semantic-web.dk#martynas> a foaf:Person ;
    foaf:mbox <mailto:martynas@graphity.org> ;
    foaf:name "Martynas Juseviƒçius" .

:query a owl:ObjectProperty ;
    rdfs:label "has SPIN query" ;
    rdfs:isDefinedBy : ;
    rdfs:range sp:Query .

:facebookApp a owl:ObjectProperty ;
    rdfs:label "has Facebook app" ;
    rdfs:isDefinedBy : ;
    rdfs:range gfb-app:type .
gfb-app:type rdfs:label "Facebook application" ;
    rdfs:isDefinedBy gfb-app: .
g:apiKey a owl:DatatypeProperty ;
    rdfs:label "SPARQL endpoint authentication key" ;
    rdfs:domain sd:Service ;
    rdfs:range xsd:string .


:Describe    a       sp:Describe ;
      sp:resultNodes (_:uri) ;
      sp:text "DESCRIBE ?uri"^^xsd:string ;
      sp:where () .
_:uri sp:varName "uri"^^xsd:string .

# =============================

:ConstructLatest    a       sp:Construct ;
      sp:templates ([ sp:object _:dateVar ;
                  sp:predicate <http://purl.org/dc/terms/date> ;
                  sp:subject _:sVar
                ] [ sp:object _:oVar ;
                  sp:predicate _:pVar ;
                  sp:subject _:sVar
                ] [ sp:object _:titleVar ;
                  sp:predicate <http://purl.org/dc/elements/1.1/title> ;
                  sp:subject _:oVar
                ]) ;
      sp:text """CONSTRUCT {
    ?s <http://purl.org/dc/elements/1.1/date> ?date .
    ?s <http://purl.org/dc/terms/date> ?date .
    ?s <http://purl.org/dc/terms/created> ?date .
    ?s <http://purl.org/dc/terms/modified> ?date .
    ?s ?p ?o .
    ?o <http://purl.org/dc/elements/1.1/title> ?title .
}
WHERE {
    {
        SELECT *
        WHERE {
            {
                GRAPH ?graph {
                    ?s <http://purl.org/dc/elements/1.1/date> ?date .
                } .
            }
            UNION
            {
                GRAPH ?graph {
                    ?s <http://purl.org/dc/terms/date> ?date .
                } .
            }
            UNION
            {
                GRAPH ?graph {
                    ?s <http://purl.org/dc/terms/created> ?date .
                } .
            }
            UNION
            {
                GRAPH ?graph {
                    ?s <http://purl.org/dc/terms/modified> ?date .
                } .
            } .
        }
        ORDER BY DESC (?date)
        LIMIT 30
    } .
    OPTIONAL {
        GRAPH ?graph {
            ?s ?p ?o .
        } .
    } .
    OPTIONAL {
        GRAPH ?objGraph {
            ?o <http://purl.org/dc/elements/1.1/title> ?title .
        } .
    } .
}"""^^xsd:string ;
      sp:where ([ a       sp:SubQuery ;
                  sp:query
                          [ a       sp:Select ;
                            sp:limit "30"^^xsd:long ;
                            sp:orderBy ([ a       sp:Desc ;
                                        sp:expression _:dateVar
                                      ]) ;
                            sp:where ([ a       sp:Union ;
                                        sp:elements (([ a       sp:NamedGraph ;
                                                      sp:elements ([ sp:object _:dateVar ;
                                                                  sp:predicate <http://purl.org/dc/elements/1.1/date> ;
                                                                  sp:subject _:sVar
                                                                ]) ;
                                                      sp:graphNameNode _:graphVar
                                                    ]) ([ a       sp:NamedGraph ;
                                                      sp:elements ([ sp:object _:dateVar ;
                                                                  sp:predicate <http://purl.org/dc/terms/date> ;
                                                                  sp:subject _:sVar
                                                                ]) ;
                                                      sp:graphNameNode _:graphVar
                                                    ]) ([ a       sp:NamedGraph ;
                                                      sp:elements ([ sp:object _:dateVar ;
                                                                  sp:predicate <http://purl.org/dc/terms/created> ;
                                                                  sp:subject _:sVar
                                                                ]) ;
                                                      sp:graphNameNode _:graphVar
                                                    ]) ([ a       sp:NamedGraph ;
                                                      sp:elements ([ sp:object _:dateVar ;
                                                                  sp:predicate <http://purl.org/dc/terms/modified> ;
                                                                  sp:subject _:sVar
                                                                ]) ;
                                                      sp:graphNameNode _:graphVar
                                                    ]))
                                      ])
                          ]
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:oVar ;
                                          sp:predicate _:pVar ;
                                          sp:subject _:sVar
                                        ]) ;
                              sp:graphNameNode _:graphVar
                            ])
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:titleVar ;
                                          sp:predicate <http://purl.org/dc/elements/1.1/title> ;
                                          sp:subject _:oVar
                                        ]) ;
                              sp:graphNameNode
                                      [ sp:varName "objGraph"^^xsd:string
                                      ]
                            ])
                ]) .
_:sVar  sp:varName "s"^^xsd:string .
_:pVar  sp:varName "p"^^xsd:string .
_:oVar  sp:varName "o"^^xsd:string .
_:graphVar  sp:varName "graph"^^xsd:string .
_:titleVar  sp:varName "title"^^xsd:string .
_:dateVar  sp:varName "date"^^xsd:string .

# =============================

_:typeVar  sp:varName "type"^^xsd:string .

:ConstructLatestClasses    a       sp:Construct ;
      sp:templates ([ sp:object _:oVar ;
                  sp:predicate _:pVar ;
                  sp:subject _:sVar
                ] [ sp:object _:titleVar ;
                  sp:predicate dc:title ;
                  sp:subject _:oVar
                ]) ;
      sp:text """PREFIX dc: <http://purl.org/dc/elements/1.1/>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
CONSTRUCT {
    ?s ?p ?o .
    ?o dc:title ?title .
}
WHERE {
    {
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT *
        WHERE {
            GRAPH ?graph {
                ?s dct:created ?date .
                ?s a ?type .
                FILTER ((?type = owl:Class) || (?type = rdfs:Class)) .
            } .
        }
        LIMIT 10
    } .
    OPTIONAL {
        GRAPH ?graph {
            ?s ?p ?o .
        } .
    } .
    OPTIONAL {
        GRAPH ?objGraph {
            ?o dc:title ?title .
        } .
    } .
}"""^^xsd:string ;
      sp:where ([ a       sp:SubQuery ;
                  sp:query
                          [ a       sp:Select ;
                            sp:limit "10"^^xsd:long ;
                            sp:where ([ a       sp:NamedGraph ;
                                        sp:elements ([ sp:object
                                                            [ sp:varName "date"^^xsd:string
                                                            ] ;
                                                    sp:predicate dct:created ;
                                                    sp:subject _:sVar
                                                  ] [ sp:object _:typeVar ;
                                                    sp:predicate rdf:type ;
                                                    sp:subject _:sVar
                                                  ] [ a       sp:Filter ;
                                                    sp:expression
                                                            [ a       sp:or ;
                                                              sp:arg1 [ a       sp:eq ;
                                                                        sp:arg1 _:typeVar ;
                                                                        sp:arg2 owl:Class
                                                                      ] ;
                                                              sp:arg2 [ a       sp:eq ;
                                                                        sp:arg1 _:typeVar ;
                                                                        sp:arg2 rdfs:Class
                                                                      ]
                                                            ]
                                                  ]) ;
                                        sp:graphNameNode _:graphVar
                                      ])
                          ]
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:oVar ;
                                          sp:predicate _:pVar ;
                                          sp:subject _:sVar
                                        ]) ;
                              sp:graphNameNode _:graphVar
                            ])
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:titleVar ;
                                          sp:predicate dc:title ;
                                          sp:subject _:oVar
                                        ]) ;
                              sp:graphNameNode
                                      [ sp:varName "objGraph"^^xsd:string
                                      ]
                            ])
                ]) .

# =============================

:ConstructItem    a       sp:Construct ;
      sp:templates ([ sp:object _:b3 ;
                  sp:predicate g:query ;
                  sp:subject _:uriVar
                ] [ sp:object _:b4 ;
                  sp:predicate sioc:has_container ;
                  sp:subject _:uriVar
                ] [ sp:object _:b1 ;
                  sp:predicate rdfs:subClassOf ;
                  sp:subject _:b2
                ] [ sp:object sioc:has_container ;
                  sp:predicate owl:onProperty ;
                  sp:subject _:b1
                ] [ sp:object _:b4 ;
                  sp:predicate owl:hasValue ;
                  sp:subject _:b1
                ] [ sp:object g:query ;
                  sp:predicate owl:onProperty ;
                  sp:subject _:b5
                ] [ sp:object _:b3 ;
                  sp:predicate owl:hasValue ;
                  sp:subject _:b5
                ]) ;
      sp:text """PREFIX g: <http://graphity.org/ontology/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX sioc: <http://rdfs.org/sioc/ns#>
CONSTRUCT {
    ?uri g:query ?query .
    ?uri sioc:has_container ?listEndpoint .
    ?itemClass rdfs:subClassOf ?containerRest .
    ?containerRest owl:onProperty sioc:has_container .
    ?containerRest owl:hasValue ?listEndpoint .
    ?queryRest owl:onProperty g:query .
    ?queryRest owl:hasValue ?query .
}
WHERE {
    {
        ?uri g:query ?query .
    }
    UNION
    {
        ?uri sioc:has_container ?listEndpoint .
        ?itemClass rdfs:subClassOf ?containerRest .
        ?containerRest owl:onProperty sioc:has_container .
        ?containerRest owl:hasValue ?listEndpoint .
        ?queryRest owl:onProperty g:query .
        ?queryRest owl:hasValue ?query .
    } .
}"""^^xsd:string ;
      sp:where ([ a       sp:Union ;
                  sp:elements (([ sp:object _:b3 ;
                                sp:predicate g:query ;
                                sp:subject _:uriVar
                              ]) ([ sp:object _:b4 ;
                                sp:predicate sioc:has_container ;
                                sp:subject _:uriVar
                              ] [ sp:object _:b1 ;
                                sp:predicate rdfs:subClassOf ;
                                sp:subject _:b2
                              ] [ sp:object sioc:has_container ;
                                sp:predicate owl:onProperty ;
                                sp:subject _:b1
                              ] [ sp:object _:b4 ;
                                sp:predicate owl:hasValue ;
                                sp:subject _:b1
                              ] [ sp:object g:query ;
                                sp:predicate owl:onProperty ;
                                sp:subject _:b5
                              ] [ sp:object _:b3 ;
                                sp:predicate owl:hasValue ;
                                sp:subject _:b5
                              ]))
                ]) .
_:uriVar  sp:varName "uri"^^xsd:string .
_:b1  sp:varName "containerRest"^^xsd:string .
_:b2  sp:varName "itemClass"^^xsd:string .
_:b3  sp:varName "query"^^xsd:string .
_:b4  sp:varName "listEndpoint"^^xsd:string .
_:b5  sp:varName "queryRest"^^xsd:string .