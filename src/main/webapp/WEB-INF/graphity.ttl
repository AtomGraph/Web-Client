@base <http://graphity.org/ontology/> .

@prefix : <> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix sioc: <http://rdfs.org/sioc/ns#> .
@prefix sp: <http://spinrdf.org/sp#> .
@prefix gfb-app: <http://graph.facebook.com/schema/application#> .

: a owl:Ontology ;
    dc:title "Graphity ontology" ;
    rdfs:seeAlso <http://graphity.org> .

:query a owl:ObjectProperty ;
    rdfs:label "has SPIN query" ;
    rdfs:isDefinedBy : ;
    rdfs:range sp:Query .

:facebookApp a owl:ObjectProperty ;
    rdfs:label "has Facebook app" ;
    rdfs:isDefinedBy : ;
    rdfs:range gfb-app:type .
gfb-app:type rdfs:label "Facebook application" ;
    rdfs:isDefinedBy gfb-app: .

:ConstructLatest    a       sp:Construct ;
      sp:templates ([ sp:object _:b4 ;
                  sp:predicate dct:created ;
                  sp:subject _:b2
                ] [ sp:object _:b5 ;
                  sp:predicate _:b3 ;
                  sp:subject _:b2
                ] [ sp:object _:b6 ;
                  sp:predicate dc:title ;
                  sp:subject _:b5
                ]) ;
      sp:text """PREFIX dc: <http://purl.org/dc/elements/1.1/>
PREFIX dct: <http://purl.org/dc/terms/>
CONSTRUCT {
    ?subject dct:created ?date .
    ?subject ?property ?object .
    ?object dc:title ?title .
}
WHERE {
    {
PREFIX dct: <http://purl.org/dc/terms/>
        SELECT *
        WHERE {
            GRAPH ?graph {
                ?subject dct:created ?date .
            } .
        }
        ORDER BY DESC (?date)
        LIMIT 10
    } .
    OPTIONAL {
        GRAPH ?graph {
            ?subject ?property ?object .
        } .
    } .
    OPTIONAL {
        GRAPH ?objGraph {
            ?object dc:title ?title .
        } .
    } .
}"""^^xsd:string ;
      sp:where ([ a       sp:SubQuery ;
                  sp:query
                          [ a       sp:Select ;
                            sp:limit "10"^^xsd:long ;
                            sp:orderBy ([ a       sp:Desc ;
                                        sp:expression _:b4
                                      ]) ;
                            sp:where ([ a       sp:NamedGraph ;
                                        sp:elements ([ sp:object _:b4 ;
                                                    sp:predicate dct:created ;
                                                    sp:subject _:b2
                                                  ]) ;
                                        sp:graphNameNode _:b1
                                      ])
                          ]
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:b5 ;
                                          sp:predicate _:b3 ;
                                          sp:subject _:b2
                                        ]) ;
                              sp:graphNameNode _:b1
                            ])
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:b6 ;
                                          sp:predicate dc:title ;
                                          sp:subject _:b5
                                        ]) ;
                              sp:graphNameNode
                                      [ sp:varName "objGraph"^^xsd:string
                                      ]
                            ])
                ]) .
_:b1  sp:varName "graph"^^xsd:string .
_:b2  sp:varName "subject"^^xsd:string .
_:b3  sp:varName "property"^^xsd:string .
_:b5  sp:varName "object"^^xsd:string .
_:b6  sp:varName "title"^^xsd:string .
_:b4  sp:varName "date"^^xsd:string .