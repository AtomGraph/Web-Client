@base <http://graphity.org/ontology/> .

@prefix : <> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix sioc: <http://rdfs.org/sioc/ns#> .
@prefix sp: <http://spinrdf.org/sp#> .

: a owl:Ontology ;
    dc:title "Graphity ontology" ;
    rdfs:seeAlso <http://graphity.org> .

:query a owl:ObjectProperty ;
    rdfs:isDefinedBy : ;
    rdfs:range sp:Query .

:ConstructLatest    a       sp:Construct ;
    rdfs:isDefinedBy : ;
      sp:templates ([ sp:object _:b2 ;
                  sp:predicate dct:created ;
                  sp:subject _:b3
                ] [ sp:object _:b1 ;
                  sp:predicate _:b5 ;
                  sp:subject _:b3
                ]) ;
      sp:text """PREFIX dct: <http://purl.org/dc/terms/>
CONSTRUCT {
    ?subject dct:created ?date .
    ?subject ?property ?object .
}
WHERE {
    {
PREFIX dct: <http://purl.org/dc/terms/>
        SELECT *
        WHERE {
            GRAPH ?graph {
                ?subject dct:created ?date .
            } .
        }
        ORDER BY DESC (?date)
        LIMIT 10
    } .
    OPTIONAL {
        GRAPH ?graph {
            ?subject ?property ?object .
        } .
    } .
}"""^^xsd:string ;
      sp:where ([ a       sp:SubQuery ;
                  sp:query
                          [ a       sp:Select ;
                            sp:limit "10"^^xsd:long ;
                            sp:orderBy ([ a       sp:Desc ;
                                        sp:expression _:b2
                                      ]) ;
                            sp:where ([ a       sp:NamedGraph ;
                                        sp:elements ([ sp:object _:b2 ;
                                                    sp:predicate dct:created ;
                                                    sp:subject _:b3
                                                  ]) ;
                                        sp:graphNameNode _:b4
                                      ])
                          ]
                ] [ a       sp:Optional ;
                  sp:elements ([ a       sp:NamedGraph ;
                              sp:elements ([ sp:object _:b1 ;
                                          sp:predicate _:b5 ;
                                          sp:subject _:b3
                                        ]) ;
                              sp:graphNameNode _:b4
                            ])
                ]) .
_:b1  sp:varName "object"^^xsd:string .
_:b2  sp:varName "date"^^xsd:string .
_:b3  sp:varName "subject"^^xsd:string .
_:b4  sp:varName "graph"^^xsd:string .
_:b5  sp:varName "property"^^xsd:string .